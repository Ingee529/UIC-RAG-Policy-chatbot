name: Deploy to Hugging Face Space

on:
  push:
    branches:
      - main   # 如果你的主分支不是 main，要改成對的名稱

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout GitHub repository
      uses: actions/checkout@v4

    - name: Sync to Hugging Face Space
      env:
        HF_TOKEN: ${{ secrets.HF_TOKEN }}
      run: |
        git config --global user.email "deploy@github-actions.com"
        git config --global user.name "GitHub Actions"

        # 1️⃣ clone 你的 HF Space repo（Docker Space）
        git clone https://user:${HF_TOKEN}@huggingface.co/spaces/Ingee529/UIC-RAG-Policy-chatbot hf_space

        # 2️⃣ 用 rsync 把 GitHub 的檔案同步過去
        #   --delete：把 HF 裡面 GitHub 已經刪掉的檔也一併刪掉
        #   --exclude ".git"：不要覆蓋 HF 自己的 .git 資料夾
        rsync -av --delete --exclude ".git" ./ hf_space

        cd hf_space

        # 3️⃣ commit + push，如果沒有變更就略過
        git add .
        git commit -m "Auto deploy from GitHub" || echo "No changes to commit"
        git push